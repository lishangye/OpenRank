import{u as M,a as S,r as $,c as b,o as B,w as N,d as z,B as j,C as P,j as H,k as f,l as u,x as h,m as p,v as g,s as l,q as a,t as k,F as x,z as D,y as d,p as R,D as E,A as c,_ as W}from"./index-D4LJPWFD.js";function q(){const w=z(),n=M(),r=S(),y=$([]),i=$(n.isAuthed?"加载中...":"请先登录再查看关注列表"),C=b(()=>new Map(y.value.map(e=>[e.repo,e]))),A=b(()=>r.favorites.map(e=>C.value.get(e.repo)||{repo:e.repo,name:e.name||e.repo,status:e.status||"",description:e.description||"来自关注，暂未同步到榜单",tags:e.tags||[]})),V=async()=>{const e=new Map;try{(await j(200,"MONTH")).forEach(o=>e.set(o.repo,o))}catch{}try{(await j(200,"WEEK")).forEach(o=>e.set(o.repo,o))}catch{}(await P()).forEach(t=>e.set(t.repo,t)),y.value=Array.from(e.values())},s=async()=>{if(!n.isAuthed){i.value="请先登录再查看关注列表";return}i.value="加载中...",await Promise.all([r.load(n.token),V()]),i.value=r.favorites.length?`已登录 · 关注 ${r.favorites.length} 个仓库`:"已登录 · 暂无关注"},m=async e=>{n.isAuthed&&(await r.remove(e,n.token),i.value=`已更新 · 关注 ${r.favorites.length} 个仓库`)},v=()=>w.push({name:"home"}),_=e=>{e&&w.push({name:"repo",query:{repo:e}})};return B(async()=>{await s()}),N(()=>n.token,async()=>{await s()}),{authStore:n,favoritesWithDisplay:A,goHome:v,goRepo:_,hint:i,loadData:s,removeFavorite:m}}const T={class:"page"},I={class:"content"},K={class:"header"},L={class:"muted"},O={key:2,class:"card-list"},G={class:"muted"},J={class:"tags"},Q=H({__name:"FavoritesView",setup(w){const{authStore:n,favoritesWithDisplay:r,goHome:y,goRepo:i,hint:C,removeFavorite:A}=q();return(V,s)=>{const m=k("el-button"),v=k("el-empty"),_=k("el-tag"),e=k("el-space"),F=k("el-card");return c(),f("div",T,[u("div",I,[u("div",K,[u("div",null,[s[0]||(s[0]=u("h1",null,"我的关注",-1)),u("p",L,g(l(C)),1)]),p(m,{size:"small",class:"btn-ghost",onClick:l(y)},{default:a(()=>[...s[1]||(s[1]=[d("返回首页",-1)])]),_:1},8,["onClick"])]),l(n).isAuthed?l(r).length?(c(),f("div",O,[(c(!0),f(x,null,D(l(r),t=>(c(),h(F,{key:t.repo,class:"glass-card",header:t.name||t.repo,onClick:o=>l(i)(t.repo)},{footer:a(()=>[p(e,null,{default:a(()=>[p(m,{size:"small",class:"btn-ghost",onClick:E(o=>l(i)(t.repo),["stop"])},{default:a(()=>[...s[2]||(s[2]=[d(" 仓库详情 ",-1)])]),_:1},8,["onClick"]),p(m,{size:"small",class:"btn",onClick:E(o=>l(A)(t.repo),["stop"])},{default:a(()=>[...s[3]||(s[3]=[d(" 取消关注 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:a(()=>[u("p",G,g(t.description||"暂无描述"),1),u("div",J,[p(e,{wrap:""},{default:a(()=>[p(_,{class:"tag-chip"},{default:a(()=>[d(g(t.repo),1)]),_:2},1024),t.status?(c(),h(_,{key:0,class:"tag-chip accent"},{default:a(()=>[d(g(t.status),1)]),_:2},1024)):R("",!0),(c(!0),f(x,null,D(t.tags||[],o=>(c(),h(_,{key:`${t.repo}-tag-${o}`,class:"tag-chip"},{default:a(()=>[d(g(o),1)]),_:2},1024))),128))]),_:2},1024)])]),_:2},1032,["header","onClick"]))),128))])):(c(),h(v,{key:1,description:"还没有关注仓库"})):(c(),h(v,{key:0,description:"请先登录再查看关注列表"}))])])}}}),X=W(Q,[["__scopeId","data-v-8e3eb26d"]]);export{X as default};

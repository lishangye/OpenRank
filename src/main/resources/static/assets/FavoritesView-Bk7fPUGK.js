import{u as z,a as B,r as $,c as x,o as N,w as P,d as H,B as D,C as L,i as R,k as f,l as u,m as y,q as n,s as m,y as _,v as w,p as o,F as E,z as M,t as S,x as p,D as j,A as r,_ as W}from"./index-Bem0sCyQ.js";function q(){const C=H(),a=z(),i=B(),h=$([]),c=$(a.isAuthed?"加载中...":"请先登录再查看关注列表"),A=x(()=>new Map(h.value.map(e=>[e.repo,e]))),F=x(()=>i.favorites.map(e=>A.value.get(e.repo)||{repo:e.repo,name:e.name||e.repo,status:e.status||"",description:e.description||"来自关注，暂未同步到榜单",tags:e.tags||[]})),V=async()=>{const e=new Map;try{(await D(200,"MONTH")).forEach(t=>e.set(t.repo,t))}catch{}try{(await D(200,"WEEK")).forEach(t=>e.set(t.repo,t))}catch{}(await L()).forEach(l=>e.set(l.repo,l)),h.value=Array.from(e.values())},s=async()=>{if(!a.isAuthed){c.value="请先登录再查看关注列表";return}c.value="加载中...",await Promise.all([i.load(a.token),V()]),c.value=i.favorites.length?`已登录 · 关注 ${i.favorites.length} 个仓库`:"已登录 · 暂无关注"},b=async e=>{a.isAuthed&&(await i.remove(e,a.token),c.value=`已更新 · 关注 ${i.favorites.length} 个仓库`)},d=()=>C.push({name:"home"}),v=e=>{e&&C.push({name:"repo",query:{repo:e}})};return N(async()=>{await s()}),P(()=>a.token,async()=>{await s()}),{authStore:a,favoritesWithDisplay:F,goHome:d,goRepo:v,hint:c,loadData:s,removeFavorite:b}}const T={class:"page"},I={class:"content"},K={class:"header"},O={class:"muted"},G={key:2,class:"card-list"},J=R({__name:"FavoritesView",setup(C){const{authStore:a,favoritesWithDisplay:i,goHome:h,goRepo:c,hint:A,removeFavorite:F}=q();return(V,s)=>{const b=m("van-nav-bar"),d=m("van-button"),v=m("van-space"),e=m("van-empty"),k=m("van-tag"),l=m("van-card");return r(),f("div",T,[u(b,{title:"我的关注","left-arrow":"",onClickLeft:n(h)},null,8,["onClickLeft"]),y("div",I,[y("div",K,[y("div",null,[s[0]||(s[0]=y("h1",null,"关注的仓库",-1)),y("p",O,w(n(A)),1)]),u(v,null,{default:o(()=>[n(a).isAuthed?S("",!0):(r(),_(d,{key:0,size:"small",round:"",type:"primary",plain:"",to:{name:"login"}},{default:o(()=>[...s[1]||(s[1]=[p(" 登录 ",-1)])]),_:1})),u(d,{size:"small",round:"",plain:"",onClick:n(h)},{default:o(()=>[...s[2]||(s[2]=[p("返回首页",-1)])]),_:1},8,["onClick"])]),_:1})]),n(a).isAuthed?n(i).length?(r(),f("div",G,[(r(!0),f(E,null,M(n(i),t=>(r(),_(l,{key:t.repo,class:"glass-card",title:t.name||t.repo,desc:t.description||"暂无描述",onClick:g=>n(c)(t.repo)},{tags:o(()=>[u(v,{wrap:""},{default:o(()=>[u(k,{class:"tag-chip"},{default:o(()=>[p(w(t.repo),1)]),_:2},1024),t.status?(r(),_(k,{key:0,class:"tag-chip accent"},{default:o(()=>[p(w(t.status),1)]),_:2},1024)):S("",!0),(r(!0),f(E,null,M(t.tags||[],g=>(r(),_(k,{key:`${t.repo}-tag-${g}`,class:"tag-chip"},{default:o(()=>[p(w(g),1)]),_:2},1024))),128))]),_:2},1024)]),footer:o(()=>[u(v,null,{default:o(()=>[u(d,{size:"small",round:"",plain:"",class:"btn-ghost",onClick:j(g=>n(c)(t.repo),["stop"])},{default:o(()=>[...s[3]||(s[3]=[p(" 仓库详情 ",-1)])]),_:1},8,["onClick"]),u(d,{size:"small",round:"",plain:"",class:"btn",icon:"star",onClick:j(g=>n(F)(t.repo),["stop"])},{default:o(()=>[...s[4]||(s[4]=[p(" 取消关注 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["title","desc","onClick"]))),128))])):(r(),_(e,{key:1,description:"还没有关注仓库"})):(r(),_(e,{key:0,description:"请先登录再查看关注列表"}))])])}}}),U=W(J,[["__scopeId","data-v-d07b5382"]]);export{U as default};
